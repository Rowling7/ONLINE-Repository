
USE [HRP-DBMS2015]

select 
RTRIM(HA0102) 单位,
sum(1) 总座数,
sum(K6008) 总延米,
SUM(CASE WHEN K6062 = '1' THEN 1 ELSE 0 END) 互通座数,
SUM(CASE WHEN K6062 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 互通延米,
sum(case when K6028 in ('4','5') then 1 else 0 end)危桥,
sum(case when K6028 in ('4','5') then K6008 else 0 end)危桥延米,
sum(case when K6004='1' then 1 else 0 end) 永久性,
sum(case when K6004='1' then K6008 else 0 end) 永久性,
sum(case when K6004='2' then 1 else 0 end) 半永久性,
sum(case when K6004='2' then K6008 else 0 end) 半永久性,
sum(case when K6004='3' then 1 else 0 end) 临时性,
sum(case when K6004='3' then K6008 else 0 end) 临时性,

RTRIM(HA0102) 单位,
COUNT(K6007) 总座数,
SUM(K6008) 总延米,
SUM(CASE WHEN K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K6007 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 特大延米,
SUM(CASE WHEN K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K6007 = '2' THEN ISNULL(K6008,0) ELSE 0 END) 大桥延米,
SUM(CASE WHEN K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K6007 = '3' THEN ISNULL(K6008,0) ELSE 0 END) 中桥延米,
SUM(CASE WHEN K6007 = '4' THEN 1 ELSE 0 END) 小桥座数,
SUM(CASE WHEN K6007 = '4' THEN ISNULL(K6008,0) ELSE 0 END) 小乔延米
from K060 
	
	WHERE  LEFT(K0101,1) IN ('G') --上行国道无H
	--WHERE  LEFT(K0101,1) IN ('S')--上行省道
	--WHERE  LEFT(K0101,1) IN ('X','Z')--上行县专道
	--WHERE  LEFT(K0101,1) IN ('H','T') --国道无H下行
GROUP BY HA0102 WITH ROLLUP
ORDER BY RTRIM(HA0102) 


--隧道
SELECT 
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总隧道数,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN A.K6305 ELSE 0 END) 总隧道延米数
FROM K063 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102
		FROM K060 
		GROUP BY HA0102,RTRIM(A0102)
		)B  ON A.HA0102 = B.HA0102
	
	WHERE  LEFT(K0101,1) IN ('G') --上行国道无H
	--WHERE  LEFT(K0101,1) IN ('S')--上行省道
	--WHERE  LEFT(K0101,1) IN ('X','Z')--上行县专道
	--WHERE  LEFT(K0101,1) IN ('H','T') --国道无H下行
GROUP BY RTRIM(B.HA0102),RTRIM(B.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.HA0102)

