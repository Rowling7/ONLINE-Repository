--31
USE [HRP-DBMS2015]
SELECT 
RTRIM(A0102) A0102,
RTRIM(HA0102) HA0102,
SUM(1) 总座数,
SUM(K6008) 总延米,
SUM(CASE WHEN K6062 = '1' THEN 1 ELSE 0 END) 互通座数,
SUM(CASE WHEN K6062 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 互通延米,
SUM(CASE WHEN K6028 IN ('4','5') THEN 1 ELSE 0 END)危桥,
SUM(CASE WHEN K6028 IN ('4','5') THEN K6008 ELSE 0 END)危桥延米,
SUM(CASE WHEN K6004='1' THEN 1 ELSE 0 END) 永久性,
SUM(CASE WHEN K6004='1' THEN K6008 ELSE 0 END) 永久性,
SUM(CASE WHEN K6004='2' THEN 1 ELSE 0 END) 半永久性,
SUM(CASE WHEN K6004='2' THEN K6008 ELSE 0 END) 半永久性,
SUM(CASE WHEN K6004='3' THEN 1 ELSE 0 END) 临时性,
SUM(CASE WHEN K6004='3' THEN K6008 ELSE 0 END) 临时性,

RTRIM(HA0102) HA0102,
SUM(CASE WHEN K6007 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总座数,
SUM(CASE WHEN K6007 IN ('1','2','3','4') THEN K6008 ELSE 0 END) 总延米,
SUM(CASE WHEN K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K6007 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 特大延米,
SUM(CASE WHEN K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K6007 = '2' THEN ISNULL(K6008,0) ELSE 0 END) 大桥延米,
SUM(CASE WHEN K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K6007 = '3' THEN ISNULL(K6008,0) ELSE 0 END) 中桥延米,
SUM(CASE WHEN K6007 = '4' THEN 1 ELSE 0 END) 小桥座数,
SUM(CASE WHEN K6007 = '4' THEN ISNULL(K6008,0) ELSE 0 END) 小乔延米
FROM K060 
GROUP BY RTRIM(HA0102),RTRIM(A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(A0102))=GROUPING(RTRIM(HA0102))

ORDER BY RTRIM(HA0102)


--隧道
SELECT 
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总隧道数,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN A.K6305 ELSE 0 END) 总隧道延米数
FROM K063 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102
		FROM K060 
		GROUP BY HA0102,RTRIM(A0102)
		)B  ON A.HA0102 = B.HA0102
GROUP BY RTRIM(B.HA0102),RTRIM(B.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.HA0102)

