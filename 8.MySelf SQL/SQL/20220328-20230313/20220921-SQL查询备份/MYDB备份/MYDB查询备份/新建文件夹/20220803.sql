IF OBJECT_ID('TEMPDB..##T1') IS NOT NULL DROP TABLE ##T1

SELECT 
	RTRIM( K1.A0102 ) A0102 --管理单位代码
	,RTRIM(K1.HA0102 ) HA0102 --管理单位
	,CASE WHEN LEN( RTRIM(K1.K0101 ) ) > 5 THEN LEFT ( RTRIM(K1.K0101 ), 3 ) ELSE RTRIM(K1.K0101 )  END  K0101 --路线编号
	--,K1.K0115+0 K0105
	,SUM(CASE WHEN K0304='10' THEN ISNULL(K0114,0) END) ZLC --7378.063
INTO ##T1 
FROM
	K001 K1
WHERE
	LEFT ( K1.K0101, 1 ) IN ( 'G', 'S', 'Z' ) AND 
	K0304='10' AND --高速
	K0192 <>'6' AND  --断链类型不是断头路
	ISNULL(K0123,'2')='2' AND  --断头路
	ISNULL(K0124,'')='' AND --重复路线
	--K0101='S40' AND 
	A0102 NOT IN ('42A72',  '42A28',' 42A50','  42A03 ','42A15 ','  42A46 ',' 42A53 ',' 42A58') AND 
	1=1
GROUP BY
	RTRIM(K1.A0102 )
	,RTRIM(K1.HA0102 )
	--,CASE WHEN LEN( RTRIM(K1.K0101 ) ) > 9 THEN LEFT ( RTRIM(K1.K0101 ), 4 ) ELSE RTRIM(K1.K0101 )  END
	--,K1.K0115
	,CASE WHEN LEN( RTRIM( K1.K0101 ) ) > 5 THEN LEFT ( RTRIM(K1.K0101 ), 3 ) ELSE RTRIM(K1.K0101 )  END

/*HAVING 
	RTRIM(K1.A0102 ) NOT IN ('42A72',  '42A28',' 42A50','  42A03 ','42A15 ','  42A46 ',' 42A53 ',' 42A58') 
	K0101='S40'*/
ORDER BY 
	K0101
	--,DK0101
	--K1.K0115,
	,SUM(CASE WHEN K0304='10' THEN ISNULL(K0114,0) END)
	ASC
	
	
SELECT T.A0102, 	T.HA0102, T.K0101
FROM ##T1 T

ORDER BY T.K0101,T.ZLC ASC



IF OBJECT_ID('TEMPDB..##T2') IS NOT NULL DROP TABLE ##T2

SELECT 
	RTRIM( K1.A0102 ) A0102 --管理单位代码
	,RTRIM(K1.HA0102 ) HA0102 --管理单位
	,CASE WHEN LEN( RTRIM(K1.K0101 ) ) > 5 THEN LEFT ( RTRIM(K1.K0101 ), 3 ) ELSE RTRIM(K1.K0101 )  END  K0101 --路线编号
	--,K1.K0115+0 K0105
	,SUM(CASE WHEN K0304='10' THEN ISNULL(K0114,0) END) ZLC --7378.063
INTO ##T2 
FROM
	K001 K1
WHERE
	LEFT ( K1.K0101, 1 ) IN ( 'G', 'S', 'Z' ) AND 
	K0304='10' AND --高速
	K0192 <>'6' AND  --断链类型不是断头路
	ISNULL(K0123,'2')='2' AND  --断头路
	ISNULL(K0124,'')='' AND --重复路线
	--K0101='S40' AND 
	--A0102 NOT IN ('42A72',  '42A28',' 42A50','  42A03 ','42A15 ','  42A46 ',' 42A53 ',' 42A58') AND 
	1=1
GROUP BY
	RTRIM(K1.A0102 )
	,RTRIM(K1.HA0102 )
	--,CASE WHEN LEN( RTRIM(K1.K0101 ) ) > 9 THEN LEFT ( RTRIM(K1.K0101 ), 4 ) ELSE RTRIM(K1.K0101 )  END
	--,K1.K0115
	,CASE WHEN LEN( RTRIM( K1.K0101 ) ) > 5 THEN LEFT ( RTRIM(K1.K0101 ), 3 ) ELSE RTRIM(K1.K0101 )  END

/*HAVING 
	RTRIM(K1.A0102 ) NOT IN ('42A72',  '42A28',' 42A50','  42A03 ','42A15 ','  42A46 ',' 42A53 ',' 42A58') 
	K0101='S40'*/
ORDER BY 
	K0101
	--,DK0101
	--K1.K0115,
	,SUM(CASE WHEN K0304='10' THEN ISNULL(K0114,0) END)
	ASC
	