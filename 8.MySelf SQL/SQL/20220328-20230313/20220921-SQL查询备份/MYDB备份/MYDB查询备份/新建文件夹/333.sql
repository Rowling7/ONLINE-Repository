
--服务区
SELECT
	T1.A0102
	,T1.HA0102 
	,T1.K0101
	,COUNT(K.K7510) 总数
FROM  
	##T2 T1
LEFT  JOIN 
	K078  K ON T1.K0101=CASE WHEN LEN( RTRIM( K.K0101 ) ) > 9 THEN LEFT ( RTRIM(K.K0101 ), 4 ) ELSE RTRIM(K.K0101 )  END  AND T1.A0102 =RTRIM( K.A0102 ) 
	
GROUP BY 
	T1.A0102
	,T1.HA0102 
	,T1.K0101
ORDER BY 
	T1.K0101 ASC
	

--隧道  对
SELECT 
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	A.K0101,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总隧道数,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN A.K6305 ELSE 0 END) 总隧道延米数
FROM K063 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102,K0101
		FROM ##T1 T
		GROUP BY HA0102,RTRIM(A0102),K0101
		)B  ON A.HA0102 = B.HA0102
GROUP BY A.K0101,RTRIM(B.HA0102),RTRIM(B.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.HA0102)




--桥梁 对
SELECT 
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	SUM(1) 总座数,
	SUM(K6008) 总延米
FROM K060 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102
		FROM ##T2
		GROUP BY HA0102,RTRIM(A0102)
		)B  ON A.HA0102 = B.HA0102
GROUP BY RTRIM(B.HA0102),RTRIM(B.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.HA0102)


--收费站
SELECT 
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	SUM(1) 总座数
	--SUM(K6008) 总延米
FROM K081 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102
		FROM ##T2
		GROUP BY HA0102,RTRIM(A0102)
		)B  ON A.HA0102 = B.HA0102
GROUP BY RTRIM(B.HA0102),RTRIM(B.A0102) --WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.A0102)