IF OBJECT_ID('tempdb..#TK01') IS NOT NULL DROP TABLE #TK01 
SELECT 
	RTRIM(K1. A0102 ) A0102 --管理单位代码
	,RTRIM(K1.HA0102 ) HA0102 --管理单位
	,CASE WHEN LEN( RTRIM(K1.K0101 ) ) > 9 THEN LEFT ( RTRIM(K1.K0101), 4) ELSE RTRIM(K1.K0101 ) END K0101 --路线编号
	, LEFT(K1.K0115,LEN(RTRIM(K1.K0115))) K0115
	,SUM(CASE WHEN K1.K0304='10'  THEN ISNULL(K1.K0114,0) END)	ZLC 
INTO #TK01
FROM K001  K1

WHERE
	LEFT ( K1.K0101, 1 ) IN ( 'G', 'S', 'Z' ) AND K1.K0304='10' AND --高速
	ISNULL(K1.K0124,'')=''  --重复路线
	
GROUP BY
	RTRIM(K1.A0102 ),RTRIM(K1.HA0102 ),K1.K0115,K1.K0123 ,K1.K0192
	,CASE WHEN LEN( RTRIM( K1.K0101 ) ) > 9 THEN LEFT ( RTRIM(K1.K0101 ), 4 ) ELSE RTRIM(K1.K0101 )  END

HAVING GROUPING(RTRIM(K1.A0102 ))=GROUPING(RTRIM(K1.HA0102 ))

ORDER BY
	CASE WHEN LEN( RTRIM(K1.K0101 ) ) > 9 THEN LEFT ( RTRIM(K1.K0101 ), 4 ) ELSE RTRIM(K1.K0101 )  END
	,SUM(CASE WHEN K1.K0304='10'  THEN ISNULL(K1.K0114,0) END)
	ASC
	
	

SELECT 
	RTRIM(K1. A0102 ) A0102 --管理单位代码
	,RTRIM(K1.HA0102 ) HA0102 --管理单位
	,K1.K0101 --路线编号
	,K1.K0115  KK--路段编号
	,K1.ZLC   KZLC--总里程

FROM #TK01  K1
 ORDER BY K1.K0101,K1.KK ASC


	
	
	/*
SELECT 
	RTRIM(K1. A0102 ) A0102 --管理单位代码
	,RTRIM(K1.HA0102 ) HA0102 --管理单位
	,K1.K0101 --路线编号
	,K1.K0115  KK--路段编号
--	,T1.K0115 TK--路段编号
	,K1.ZLC   KZLC--总里程	
--	,T1.ZLC   TZLC--总里程
FROM #TK01  K1
--LEFT JOIN #TK01 T1 
--	ON LEFT(T1.K0115,LEN(RTRIM(T1.K0115)))+1  = LEFT(K1.K0115,LEN(RTRIM(K1.K0115))) 
WHERE
	K1.A0102 ='42A72' AND 
	K1.K0101 ='G59' 
	--K1.A0102 ='42A53' AND 
	--K1.K0101 ='G6911' 
GROUP BY 
	RTRIM(K1. A0102 ) 
	,RTRIM(K1.HA0102 ) 
	,K1.K0101 
	,K1.K0115  
--	,T1.K0115 
	,K1.ZLC
--	,T1.ZLC  

--HAVING GROUPING(K1.K0115)=GROUPING(T1.K0115)
ORDER BY K1.K0115 ASC
*/