USE [HRP-DBMS2021湖北]
SELECT D.OBJNAME 行政代码,D.OBJJC 行政名称,A.总里程,A.合计 AS  '合计:高速+1+2+3+4',A.高速,A.高速四车道,A.高速六车道,A.高速八车道,A.一级,A.二级,A.一幅高速,A.三级,A.四级,A.准四级,A.等外
FROM (
SELECT
(CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END) AS A0102,
D.OBJJC ,
SUM(ISNULL(K0114,0))总里程,
SUM(CASE WHEN ISNULL(K0304,'') <> '30' THEN ISNULL(K0114,0) END) 合计,
SUM(CASE WHEN K0304='10' AND K0404 IN('4','6','8') THEN ISNULL(K0114,0) END)	高速,
sum(case when K0304='10' and K0404='4' then isnull(K0114,0) end)	高速四车道,
sum(case when K0304='10' and K0404='6' then isnull(K0114,0) end)	高速六车道,
sum(case when K0304='10' and K0404='8' then isnull(K0114,0) end)	高速八车道,
SUM(CASE WHEN K.K0304='11' THEN ISNULL(K.K0114,0) END)	一级,
SUM(CASE WHEN K.K0304='22' THEN ISNULL(K.K0114,0) END)	二级,
SUM(CASE WHEN K.K0126='1' THEN ISNULL(K.K0114,0) END)	一幅高速,
SUM(CASE WHEN K.K0304='23' THEN ISNULL(K.K0114,0) END)	三级,
SUM(CASE WHEN K.K0304='24' THEN ISNULL(K.K0114,0) END)	四级,
SUM(CASE WHEN K.K0304='31' THEN ISNULL(K.K0114,0) END)	准四级,
SUM(CASE WHEN K.K0304='30' THEN ISNULL(K.K0114,0) END)	等外
FROM  K001 K
LEFT JOIN DA0102 D  ON (CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END)=  D.OBJNAME
WHERE ISNULL(K0124,'')='' AND ISNULL(K0123,'2')='2' AND A0102 LIKE '42%' AND
LEFT(K0101,1) IN ('G','S','X','Y','Z','C')
--K0101 LIKE 'S%'
AND ISNULL(V0301,'2')='2'
GROUP BY ((CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END)),D.OBJJC
	WITH ROLLUP
HAVING GROUPING((CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END))= GROUPING(D.OBJJC )
--ORDER BY K.A0102
) AS A
RIGHT JOIN DA0102 D ON D.OBJNAME= A.A0102
WHERE D.PARENTID ='1'
ORDER BY D.OBJNAME

SELECT
(CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END) AS A0102,
D.OBJJC ,
SUM(ISNULL(K0114,0))总里程,
SUM(CASE WHEN ISNULL(K0304,'') <> '30' THEN ISNULL(K0114,0) END)  '合计:高速+1+2+3+4',
SUM(CASE WHEN K0304='10' AND K0404 IN('4','6','8') THEN ISNULL(K0114,0) END)	高速,
sum(case when K0304='10' and K0404='4' then isnull(K0114,0) end)	高速四车道,
sum(case when K0304='10' and K0404='6' then isnull(K0114,0) end)	高速六车道,
sum(case when K0304='10' and K0404='8' then isnull(K0114,0) end)	高速八车道,
SUM(CASE WHEN K.K0304='11' THEN ISNULL(K.K0114,0) END)	一级,
SUM(CASE WHEN K.K0304='22' THEN ISNULL(K.K0114,0) END)	二级,
SUM(CASE WHEN K.K0126='1' THEN ISNULL(K.K0114,0) END)	一幅高速,
SUM(CASE WHEN K.K0304='23' THEN ISNULL(K.K0114,0) END)	三级,
SUM(CASE WHEN K.K0304='24' THEN ISNULL(K.K0114,0) END)	四级,
SUM(CASE WHEN K.K0304='31' THEN ISNULL(K.K0114,0) END)	准四级,
SUM(CASE WHEN K.K0304='30' THEN ISNULL(K.K0114,0) END)	等外
FROM  K001 K
LEFT JOIN DA0102 D  ON (CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END)=  D.OBJNAME

WHERE ISNULL(K0124,'')='' AND ISNULL(K0123,'2')='2' AND A0102 LIKE '42%' AND
LEFT(K0101,1) IN ('G','S','X','Y','Z','C')
--K0101 LIKE 'S%'
AND ISNULL(V0301,'2')='2'
GROUP BY ((CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END)),D.OBJJC
	WITH ROLLUP
HAVING GROUPING((CASE WHEN LEN(K.A0102)='6'AND LEFT(K.A0102,4)<4290 THEN LEFT (K.A0102,4) ELSE
	CASE WHEN LEN(K.A0102)='5' THEN LEFT(K.A0102, 3) ELSE
		K.A0102 END END))= GROUPING(D.OBJJC )
ORDER BY K.A0102



