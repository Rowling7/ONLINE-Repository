--桥梁汇总（按路线）
SELECT
RTRIM(K0112) K0102,
RTRIM(CASE WHEN LEN(K0101)>9 THEN LEFT(K0101,4)ELSE K0101 END),
SUM(CASE WHEN K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K6007 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 特大延米,
SUM(CASE WHEN K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K6007 = '2' THEN ISNULL(K6008,0) ELSE 0 END) 大桥延米,
SUM(CASE WHEN K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K6007 = '3' THEN ISNULL(K6008,0) ELSE 0 END) 中桥延米,
SUM(CASE WHEN K6007 = '4' THEN 1 ELSE 0 END) 小桥座数,
SUM(CASE WHEN K6007 = '4' THEN ISNULL(K6008,0) ELSE 0 END) 小乔延米,
COUNT(CASE WHEN K6007 in( '1','2','3','4') THEN 1 ELSE 0 END) 总座数,
SUM(K6008)总延米
FROM k060
WHERE  LEFT(K0101,1) NOT IN ('H','T')
GROUP BY  RTRIM(K0112),RTRIM(CASE WHEN LEN(K0101)>9 THEN LEFT(K0101,4)ELSE K0101 END) WITH ROLLUP
order by k0102


--全省公路桥梁汇总表
USE [HRP-DBMS2015]
SELECT
RTRIM(A0102) A0102,
RTRIM(HA0102) HA0102,
SUM(1) 总座数,
SUM(K6008) 总延米,
SUM(CASE WHEN K6062 = '1' THEN 1 ELSE 0 END) 互通座数,
SUM(CASE WHEN K6062 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 互通延米,
SUM(CASE WHEN K6028 IN ('4','5') THEN 1 ELSE 0 END)危桥,
SUM(CASE WHEN K6028 IN ('4','5') THEN K6008 ELSE 0 END)危桥延米,
SUM(CASE WHEN K6004='1' THEN 1 ELSE 0 END) 永久性,
SUM(CASE WHEN K6004='1' THEN K6008 ELSE 0 END) 永久性,
SUM(CASE WHEN K6004='2' THEN 1 ELSE 0 END) 半永久性,
SUM(CASE WHEN K6004='2' THEN K6008 ELSE 0 END) 半永久性,
SUM(CASE WHEN K6004='3' THEN 1 ELSE 0 END) 临时性,
SUM(CASE WHEN K6004='3' THEN K6008 ELSE 0 END) 临时性,
RTRIM(HA0102) HA0102,
SUM(CASE WHEN K6007 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总座数,
SUM(CASE WHEN K6007 IN ('1','2','3','4') THEN K6008 ELSE 0 END) 总延米,
SUM(CASE WHEN K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K6007 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 特大延米,
SUM(CASE WHEN K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K6007 = '2' THEN ISNULL(K6008,0) ELSE 0 END) 大桥延米,
SUM(CASE WHEN K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K6007 = '3' THEN ISNULL(K6008,0) ELSE 0 END) 中桥延米,
SUM(CASE WHEN K6007 = '4' THEN 1 ELSE 0 END) 小桥座数,
SUM(CASE WHEN K6007 = '4' THEN ISNULL(K6008,0) ELSE 0 END) 小乔延米
FROM K060
GROUP BY RTRIM(HA0102),RTRIM(A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(A0102))=GROUPING(RTRIM(HA0102))
ORDER BY RTRIM(HA0102)

--隧道
SELECT
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总隧道数,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN A.K6305 ELSE 0 END) 总隧道延米数
FROM K063 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102
		FROM K060
		GROUP BY HA0102,RTRIM(A0102)
		)B  ON A.HA0102 = B.HA0102
GROUP BY RTRIM(B.HA0102),RTRIM(B.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.HA0102)


--桥梁年底到达数汇总(国高网无H)
USE [HRP-DBMS2015]
select
RTRIM(HA0102) 单位,
sum(1) 总座数,
sum(K6008) 总延米,
SUM(CASE WHEN K6062 = '1' THEN 1 ELSE 0 END) 互通座数,
SUM(CASE WHEN K6062 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 互通延米,
sum(case when K6028 in ('4','5') then 1 else 0 end)危桥,
sum(case when K6028 in ('4','5') then K6008 else 0 end)危桥延米,
sum(case when K6004='1' then 1 else 0 end) 永久性,
sum(case when K6004='1' then K6008 else 0 end) 永久性,
sum(case when K6004='2' then 1 else 0 end) 半永久性,
sum(case when K6004='2' then K6008 else 0 end) 半永久性,
sum(case when K6004='3' then 1 else 0 end) 临时性,
sum(case when K6004='3' then K6008 else 0 end) 临时性,
RTRIM(HA0102) 单位,
COUNT(K6007) 总座数,
SUM(K6008) 总延米,
SUM(CASE WHEN K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K6007 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 特大延米,
SUM(CASE WHEN K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K6007 = '2' THEN ISNULL(K6008,0) ELSE 0 END) 大桥延米,
SUM(CASE WHEN K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K6007 = '3' THEN ISNULL(K6008,0) ELSE 0 END) 中桥延米,
SUM(CASE WHEN K6007 = '4' THEN 1 ELSE 0 END) 小桥座数,
SUM(CASE WHEN K6007 = '4' THEN ISNULL(K6008,0) ELSE 0 END) 小乔延米
from K060
	WHERE  LEFT(K0101,1) IN ('G') --上行国道无H
	--WHERE  LEFT(K0101,1) IN ('S')--上行省道
	--WHERE  LEFT(K0101,1) IN ('X','Z')--上行县专道
	--WHERE  LEFT(K0101,1) IN ('H','T') --国道无H下行
GROUP BY HA0102 WITH ROLLUP
ORDER BY RTRIM(HA0102)


--隧道
SELECT
	RTRIM(B.A0102) A0102,
	RTRIM(B.HA0102) HA0102,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN 1 ELSE 0 END) 总隧道数,
	SUM(CASE WHEN A.K6304 IN ('1','2','3','4') THEN A.K6305 ELSE 0 END) 总隧道延米数
FROM K063 A
	RIGHT JOIN (
		SELECT RTRIM(HA0102) HA0102,RTRIM(A0102) A0102
		FROM K060
		GROUP BY HA0102,RTRIM(A0102)
		)B  ON A.HA0102 = B.HA0102
	WHERE  LEFT(K0101,1) IN ('G') --上行国道无H
	--WHERE  LEFT(K0101,1) IN ('S')--上行省道
	--WHERE  LEFT(K0101,1) IN ('X','Z')--上行县专道
	--WHERE  LEFT(K0101,1) IN ('H','T') --国道无H下行
GROUP BY RTRIM(B.HA0102),RTRIM(B.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(B.A0102))=GROUPING(RTRIM(B.HA0102))
ORDER BY RTRIM(B.HA0102)


--2020年桥梁分行政区划
SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4201%'--武汉
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4202%'--黄石市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4203%'--十堰市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4205%'--宜昌市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4206%'--襄阳市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4207%'--鄂州市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4208%'--荆门市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4209%'--孝感市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4210%'--荆州市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4211%'--黄冈市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4212%'--咸宁市
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4213%'
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '4228%'
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '429004%'
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '429005%'
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC

SELECT
RTRIM(K.A0102)A0102,
RTRIM(K.HA0102) HA0102,
COUNT(K.K6007) 总座数,
SUM(CASE WHEN K.K6007 = '1' THEN 1 ELSE 0 END) 特大座数,
SUM(CASE WHEN K.K6007 = '2' THEN 1 ELSE 0 END) 大桥座数,
SUM(CASE WHEN K.K6007 = '3' THEN 1 ELSE 0 END) 中桥座数,
SUM(CASE WHEN K.K6007 = '4' THEN 1 ELSE 0 END) 小桥座数
from K060 K
WHERE RTRIM(K.A0103) LIKE '429006%'
GROUP BY RTRIM(K.HA0102),RTRIM(K.A0102) WITH ROLLUP
HAVING GROUPING(RTRIM(K.HA0102))=GROUPING(RTRIM(K.A0102))
ORDER BY K.HA0102 ASC


--全省高速公路桥梁年底到达数(分评定等级)

SELECT RTRIM(HA0102),
COUNT(*) 总座数,
SUM(K6008)总延米,
--LEFT(A1305,4),
SUM(CASE WHEN K6028 = '1' THEN 1 ELSE 0 END) 一类座数,
SUM(CASE WHEN K6028 = '1' THEN ISNULL(K6008,0) ELSE 0 END) 一类延米,
SUM(CASE WHEN K6028 = '2' THEN 1 ELSE 0 END) 二类座数,
SUM(CASE WHEN K6028 = '2' THEN ISNULL(K6008,0) ELSE 0 END) 二类延米,
SUM(CASE WHEN K6028 = '3' THEN 1 ELSE 0 END) 三类座数,
SUM(CASE WHEN K6028 = '3' THEN ISNULL(K6008,0) ELSE 0 END) 三类延米,
SUM(CASE WHEN K6028 = '4' THEN 1 ELSE 0 END) 四类座数,
SUM(CASE WHEN K6028 = '4' THEN ISNULL(K6008,0) ELSE 0 END) 四类延米,
SUM(CASE WHEN K6028 = '5' THEN 1 ELSE 0 END) 五类座数,
SUM(CASE WHEN K6028 = '5' THEN ISNULL(K6008,0) ELSE 0 END) 五类延米,
SUM(CASE WHEN K6028 = '9' THEN 1 ELSE 0 END) 未评定座数,
SUM(CASE WHEN K6028 = '9' THEN ISNULL(K6008,0) ELSE 0 END) 未评定延米
FROM K060
GROUP BY  HA0102  WITH ROLLUP



--SQL溢用：合并列值
SELECT *
FROM(
SELECT DISTINCT HA0102
FROM #TK01
)A
OUTER APPLY(
SELECT [路线编码]= STUFF(
REPLACE(--第1个替换开始
	REPLACE(--第2个替换开始
(
SELECT K0101
FROM #TK01 N
WHERE HA0102 = A.HA0102 AND LEFT (K0101,1) IN('G','S','Z')
FOR XML AUTO
),
'<N K0101="', ','),--第1个替换结束
  '"/>', ''), --第2个替换结束
  1, 1, '')
)N
OUTER APPLY(
SELECT
[路线名称]= STUFF(REPLACE(REPLACE(
(
SELECT K0112
FROM #TK01 M
WHERE HA0102 = A.HA0102 AND LEFT (K0101,1)  IN('G','S','Z')
FOR XML AUTO
), '<M K0112="', ','), '"/>', ''), 1, 1, '')
)M