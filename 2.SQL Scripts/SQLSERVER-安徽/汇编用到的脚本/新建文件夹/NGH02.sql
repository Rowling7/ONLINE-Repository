/*不显示零*/

SELECT 
	CASE WHEN GROUPING(A.A0102)=1 THEN '合  计' ELSE MAX(RTRIM(E.OBJJC)) END,
	CASE WHEN GROUPING(A.A0102)=1 THEN '' ELSE A.A0103 END,
	SUM(B.XZSL),
	SUM(B.XZTC),
	SUM(B.XZTSJ),
	SUM(B.XZTD),
	SUM(B.XZWTD),
	SUM(C.JZCSL),
	SUM(C.JZCTC),
	SUM(C.JZCTSCD),
	SUM(C.JZCTD),
	SUM(C.JZCWTD),
	SUM(D.ZRCSL),
	SUM(D.ZRCTC),
	SUM(D.ZRCWTC)
FROM
(
	SELECT A0102,LEFT(V0501,6) A0103 FROM [HRP-DBMS2014]..V51
	WHERE A0102 LIKE '34%'
	GROUP BY A0102,LEFT(V0501,6)
	UNION
	SELECT A0102,LEFT(V0514,6) A0103 FROM [HRP-DBMS2014]..V52
	WHERE A0102 LIKE '34%'
	GROUP BY A0102,LEFT(V0514,6)
	UNION
	SELECT A0102,LEFT(V0514,6) A0103 FROM [HRP-DBMS2014]..V53
	WHERE A0102 LIKE '34%'
	GROUP BY A0102,LEFT(V0514,6)
) A 
	LEFT JOIN
(
	SELECT	A0102,LEFT(V0501,6) A0103,
		COUNT(*) XZSL,
		SUM(CASE WHEN ISNULL(V8101,'')='1' THEN 1 ELSE 0 END)	XZTC,
		SUM(CASE WHEN ISNULL(V0502,'2')='1' THEN 1 ELSE 0 END)	XZTSJ,
		SUM(CASE WHEN ISNULL(V8101,'')='2' THEN 1 ELSE 0 END)	XZTD,
		SUM(CASE WHEN ISNULL(V8101,'')='3' THEN 1 ELSE 0 END)	XZWTD
	FROM [HRP-DBMS2014]..V51
	WHERE ISNULL(V0504,'') IN ('12','13') AND A0102 LIKE '34%'
	GROUP BY A0102,LEFT(V0501,6)
) B ON A.A0102=B.A0102 AND A.A0103=B.A0103
	LEFT JOIN
(
	SELECT	A0102,LEFT(V0514,6) A0103,
		COUNT(*) JZCSL,
		SUM(CASE WHEN ISNULL(V8101,'')='1' THEN 1 ELSE 0 END)	JZCTC,
		SUM(CASE WHEN ISNULL(V0513,'2')='1' THEN 1 ELSE 0 END)	JZCTSCD,
		SUM(CASE WHEN ISNULL(V8101,'')='2' THEN 1 ELSE 0 END)	JZCTD,
		SUM(CASE WHEN ISNULL(V8101,'')='3' THEN 1 ELSE 0 END)	JZCWTD
	FROM [HRP-DBMS2014]..V52
	WHERE ISNULL(V0505,'') IN ('22') AND A0102 LIKE '34%'
	GROUP BY A0102,LEFT(V0514,6)
) C ON A.A0102=C.A0102 AND A.A0103=C.A0103
	LEFT JOIN
(
	SELECT	A0102,LEFT(V0514,6) A0103,
		COUNT(*) ZRCSL,
		SUM(CASE WHEN ISNULL(V5708,'2')='1' THEN 1 ELSE 0 END)	ZRCTC,
		SUM(CASE WHEN ISNULL(V5708,'2')='2' THEN 1 ELSE 0 END)	ZRCWTC
	FROM [HRP-DBMS2014]..V53
	WHERE A0102 LIKE '34%'
	GROUP BY A0102,LEFT(V0514,6)
) D ON A.A0102=D.A0102 AND A.A0103=D.A0103
LEFT JOIN DA0102 E ON A.A0102=E.OBJNAME
GROUP BY A.A0102,A.A0103 WITH ROLLUP
HAVING NOT (GROUPING(A.A0102)<>1 AND GROUPING(A.A0103)=1)
ORDER BY A.A0102,A.A0103
